{% comment %}
=============================================================================
DYNAMIC DATA LOADER FOR JEKYLL
=============================================================================
This entire block dynamically sets the 'resume_data' variable.
Its goal is to find the correct data folder (or "data object") based on the 
'active_resume_path_ar' variable set in your _config.yml file.

The rest of the template can then use 'resume_data' 
(e.g., 'resume_data.experience', 'resume_data.links') without 
caring *where* that data actually came from.
{% endcomment %}

{% comment %}
    STEP 1: Get the path string from the config file.
    'site.active_resume_path_ar' reads the value from _config.yml.
    We assign it to a new, shorter variable called 'data_path_string'.
{% endcomment %}
{% assign data_path_string = site.active_resume_path_ar %}

{% comment %}
    STEP 2: Check if the path is empty.
    This 'if' statement checks if 'data_path_string' is either an
    empty string ("") or 'nil' (which means it wasn't defined at all).
    This is our "default" or "fallback" case for files in the root _data/ folder.
{% endcomment %}
{% if data_path_string == "" or data_path_string == nil %}
    
    {% comment %}
        FALLBACK CASE: The path was empty.
        We assign 'resume_data' to be the top-level 'site.data' object.
        This means the rest of the template will look for files directly in 
        the _data/ folder (e.g., 'site.data.experience' from _data/experience.yml).
    {% endcomment %}
    {% assign resume_data = site.data %}
    
    {% else %}
    
    {% comment %}
        ACTIVE CASE: A path was provided (e.g., "ar" or "ProjectManager").
        Now we need to "drill down" to find the correct data object.
    {% endcomment %}
    
    {% comment %}
        STEP 3: Split the path string into parts.
        The 'split: "."' filter takes the string and breaks it into an
        array (a list) using the dot '.' as the separator.
        If data_path_string = "2025-06.20250621-PM"
        Then path_parts = ["2025-06", "20250621-PM"]
        If data_path_string = "ar"
        Then path_parts = ["ar"]
    {% endcomment %}
    {% assign path_parts = data_path_string | split: '.' %}
    
    {% comment %}
        STEP 4: Set the starting point for our loop.
        We create a temporary variable 'data_object' and set it to the 
        very top of the data tree, 'site.data'. This is the object
        we will "drill down" into.
    {% endcomment %}
    {% assign data_object = site.data %}
    
    {% comment %}
        STEP 5: The Loop.
        This 'for' loop iterates over the 'path_parts' array we created.
        For each 'part' in the list, it will run the code inside.
    {% endcomment %}
    {% for part in path_parts %}
        
        {% comment %}
            THE CORE LOGIC: Drilling Down with Bracket Notation.
            
            This is the most important line. It re-assigns 'data_object'
            to be a *child* of itself, using the current 'part' as the key.
            
            It uses BRACKET NOTATION: data_object[part]
            
            WHY BRACKET NOTATION?
            In Liquid, you can access data in two ways:
            1. Dot Notation:    site.data.ar
            2. Bracket Notation: site.data['ar']
            
            Dot notation fails if the key starts with a number (like "2025-06").
            Liquid sees 'site.data.2025-06' and gets confused.
            
            Bracket notation *always* works because it treats the key as a
            string, no matter what it contains. 'site.data['2025-06']' is valid.
            
            Since our 'part' variable holds a string, 'data_object[part]' is
            the perfect way to safely access the next level down.
            
            HOW THE LOOP WORKS (Example: Your path is _data/2025-06/20250621-PM/)
            
            - Your config string is: data_path_string = "2025-06.20250621-PM"
            - The split array is:   path_parts = ["2025-06", "20250621-PM"]
            
            - Before loop: data_object = site.data
            
            - Loop 1: 
            - part = "2025-06"
            - code runs: data_object = data_object["2025-06"]
            - result:    data_object = site.data['2025-06']
            
            - Loop 2:
            - part = "20250621-PM"
            - code runs: data_object = data_object["20250621-PM"]
            - result:    data_object = site.data['2025-06']['20250621-PM']
            
            - Loop ends.
        {% endcomment %}
        {% assign data_object = data_object[part] %}
    
    {% endfor %}
    
    {% comment %}
        STEP 6: Final Assignment.
        
        After the loop has finished, 'data_object' holds our target folder 
        (e.g., site.data.ar or site.data['2025-06']['20250621-PM']).
        
        We now assign this final object to the 'resume_data' variable that
        the rest of the template will use.
    {% endcomment %}
    {% assign resume_data = data_object %}

{% endif %}

{% comment %}
=============================================================================
DYNAMIC DATA LOADER ENDS
=============================================================================

From this point on, you can just use 'resume_data' variable.

- If config was empty (""):
resume_data.experience == site.data.experience

- If config was "ar":
resume_data.experience == site.data.ar.experience

- If config was "2025-06.20250621-PM":
resume_data.experience == site.data['2025-06']['20250621-PM'].experience
{% endcomment %}

<!DOCTYPE html>
<html lang="ar" dir="rtl">
    <!-- هذه الصفحة تم تحديثها آخر مرة في {{ "now" | date: "%Y-%m-%d %H:%M:%S" }}Z -->

    <head>
        {% include shared-head.html %}

        {% include resume-head-ar.html %}

        {% seo %}

        {% include analytics-head.html %}
    </head>

    <body class="theme-{% if site.resume_theme %}{{ site.resume_theme }}{% endif %}">

        <div class="wrapper" itemscope itemtype="http://schema.org/Person">
            <meta itemprop="telephone" content="{{ site.contact_info.phone }}" />
            <meta itemprop="address" content="{{ site.contact_info.address }}" />

            <header class="page-header">

                {% if site.resume_avatar == true %}
                    <!-- You can turn off the avatar in _config.yml by setting to false -->
                    <a href="{{ '/'  | relative_url }}" title="الصفحة الرئيسية" target="_blank" rel="noopener">
                        <img src="{{ '/assets/images/Profile-min.jpg' | relative_url }}" alt="صورتي" class="avatar no-print" itemprop="image">
                    </a>
                {% endif %}

                <!-- Your name is defined in the _config.yml file -->
                <h1 class="header-name" itemprop="name">
                    {{ site.name_ar.first }} {{ site.name_ar.middle }} {{ site.name_ar.last }}
                </h1>

                {% if site.display_header_contact_info == true %}
                    <!-- To display contact info here, change `display_header_contact_info` value in _config.yml to true -->
                    <div class="header-contact-info">
                        <p>
                            {% if site.enable_live == true %}
                                {% if site.contact_info.phone_live %}
                                    <a href="tel:{{ site.contact_info.phone_live | remove: ' ' }}" dir="ltr" style="text-decoration: none; color: inherit;">{{ site.contact_info.phone_live }}</a>&nbsp;{% include vendors/lineicons-v4.0/phone.svg %}
                                {% endif %}
                            {% else %}
                                {% if site.contact_info.phone %}
                                    <a href="tel:{{ site.contact_info.phone_live | remove: ' ' }}" dir="ltr" style="text-decoration: none; color: inherit;">{{ site.contact_info.phone }}</a>&nbsp;{% include vendors/lineicons-v4.0/phone.svg %}
                                {% endif %}
                            {% endif %}

                            {% if site.enable_live == true %}
                                {% if site.contact_info.email_live %}
                                    &nbsp;&nbsp;{{ site.contact_info.email_live }}&nbsp;{% include vendors/lineicons-v4.0/envelope.svg %}
                                {% endif %}
                            {% else %}
                                {% if site.contact_info.email %}
                                    &nbsp;&nbsp;{{ site.contact_info.email }}&nbsp;{% include vendors/lineicons-v4.0/envelope.svg %}
                                {% endif %}
                            {% endif %}

                            {% if site.contact_info.address_ar %}
                                &nbsp;&nbsp;{{ site.contact_info.address_ar }}&nbsp;{% include vendors/lineicons-v4.0/postcard.svg %}
                            {% endif %}

                            {% if site.contact_info.dob %}
                                &nbsp;&nbsp;تاريخ الميلاد:&nbsp;{% include ar-date.html date=site.contact_info.dob style="MDY" %}
                            {% endif %}

                            {% assign active_languages = resume_data.languages | where: "active", true %}
                            {% if site.resume_section.lang_header and active_languages.size > 0 %}
                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                <span style="white-space: nowrap;">
                                    <strong>اللغات:</strong>
                                    {% for lang in active_languages %}
                                        {{ lang.language }} ({{ lang.descrp_short }}){% unless forloop.last %}، {% endunless %}
                                    {% endfor %}
                                </span>
                            {% endif %}
                        </p>
                    </div>
                {% endif %}

                <div class="title-bar no-print">
                    <!-- Your title is also defined in the _config.yml file -->
                    <h2 class="header-title" itemprop="jobTitle">{{ site.resume_title_ar }}</h2>

                    <!-- This is the markup for the icon links; moved out to an include because it's very verbose, and you shouldn't ever need to edit the markup (unless you want to re-order the icons); if you want to customize which links appear, define them in the _config.yml file -->
                    {% if site.social_links %}
                    <!-- and guess where these are defined? Yup, you guessed it: the _config.yml file -->
                        <ul class="social-links">
                            {% include social-links.html %}
                        </ul>
                    {% endif %}
                </div>

                {% if site.resume_header_intro_ar == true %}
                <div class="executive-summary" itemprop="description">
                    <p>{{ resume_data.header.intro }}</p>
                </div>
                {% endif %}

                {% if site.resume_looking_for_work == true %}
                  <button id="contactBtn" class="your-button-class contact-button no-print" itemprop="email">تواصل معي</button>
                {% elsif site.resume_looking_for_work == false %}
                    <a class="contact-button not-looking no-print">لستُ باحثاً عن عمل حالياً.</a>
                {% else %}
                {% endif %}
            </header>

            {% comment %}
            =============================================================================
              DYNAMIC SECTION RENDERING (ARABIC)
            =============================================================================
              Loop through resume_section_order from _config.yml and render each section
              with Arabic labels and "حتى الآن" for Present.
            {% endcomment %}
            {%- for section_name in site.resume_section_order -%}
                {% include resume-section-ar.html section_name=section_name %}
            {%- endfor -%}

            {% if site.resume_print_social_links %}
                <!-- begin Print Social Links -->
                <section class="content-section print-only">

                    <header class="section-header">
                        <h2>روابط التواصل</h2>
                    </header>

                    <div class="resume-item">
                        {% include print-social-links.html %}
                    </div>

                </section>
                <!-- end Print Social Links -->
            {% endif %}

            <footer class="page-footer no-print">
                <p class="footer-line">
                    تم إنشاء هذه الصفحة بتاريخ {{ "now" | date: "%Y-%m-%d" }} في {{ "now" | date: "%H:%M:%S" }}Z.
                </p>
                <p class="copyright">{{ site.title }} &copy; 2018 - {{ "now" | date: "%Y" }}</p>
            </footer>

            {% if site.enable_live == false %}
                <footer class="page-footer print-only">
                    <p class="footer-line">
                        تم إنشاء هذه السيرة الذاتية بتاريخ {{ "now" | date: "%Y-%m-%d" }} في {{ "now" | date: "%H:%M:%S" }}Z.
                        <br>
                        <a href="{{ page.url | replace:'index.html','' | prepend: site.baseurl | prepend: site.url }}" target="_blank" rel="noopener noreferrer" style="font-weight: 100; color: #999;">
                            {{ page.url | replace:'index.html','' | prepend: site.baseurl | prepend: site.url }}
                        </a>
                    </p>
                </footer>
            {% endif %}
        </div>

        {%- include contact-form.html -%} <!-- Your include is already here -->

        <!-- begin contact script block -->
        <script>
          (function() {
            // Get all the elements
            var modal = document.getElementById("contactModal");
            var btn = document.getElementById("contactBtn");
            var span = document.getElementById("closeBtn");
      
            // Check if the elements exist before adding listeners
            if (btn) {
              // When the user clicks the button, show the modal
              btn.onclick = function() {
                modal.style.display = "flex";
              }
            }
      
            if (span) {
              // When the user clicks on <span> (x), close the modal
              span.onclick = function() {
                modal.style.display = "none";
              }
            }
      
            // When the user clicks anywhere on the gray overlay, close the modal
            window.onclick = function(event) {
              if (event.target == modal) {
                modal.style.display = "none";
              }
            }
          })();
        </script>
        <!-- end contact script block -->
    </body>
</html>
